# DS18B20_Embedded_ApplicationV2 실시간 테스트 문제 해결 및 패치 내역

## 1. 시나리오 기반 테스트 실패 원인 및 해결

### 1.1 시나리오 2번(JSON) 테스트 실패
- **문제:** 시나리오 2번 JSON의 첫 번째 expect 값이 실제 펌웨어 출력과 불일치.
- **해결:** scenarioJson/02_multi_id_change_scenario.json의 첫 expect를 실제 출력에 맞게 패치.

### 1.2 시나리오 3번(JSON) 테스트 실패
- **문제:** 6번째 스텝에서 '센서 2번을 변경할까요? (y/n, 취소:c)' 안내문이 출력되어야 하나, 복수 센서 ID 변경 안내문이 출력됨.
- **해결:** src/application/MenuController.cpp의 handleSensorIdSelectState() 로직을 수정하여, 복수 선택 시에도 첫 센서에 대해 올바른 안내문이 출력되도록 패치.

## 2. 테스트 코드 개선 내역

### 2.1 멀티라인/배열 expect 처리
- **문제:** JSON expect가 배열/멀티라인일 때, 인코딩/개행 차이로 매칭 실패.
- **해결:** test_json_driven_copy.py에서 expect가 배열이면 각 요소별 부분 문자열 매칭, 문자열이면 줄별로 부분 매칭하도록 개선. strip/replace로 인코딩/개행 차이 무시.

### 2.2 시나리오 expect 표준화
- **문제:** 일부 시나리오 expect가 문자열/배열 혼용되어 테스트 불안정.
- **해결:** 모든 시나리오 expect를 배열로 통일하여, 멀티라인 매칭이 일관되게 동작하도록 개선.

## 3. 펌웨어 메뉴 안내문/상태 전환 버그

### 3.1 복수 센서 ID 변경 안내문 출력 버그
- **문제:** 복수 센서 ID 변경 메뉴에서 센서 번호 입력 후, 첫 센서 변경 안내문이 출력되지 않음.
- **해결:** handleSensorIdSelectState()에서 선택된 센서가 있을 때, 첫 센서에 대해 '센서 N번을 변경할까요?' 안내문을 반드시 출력하도록 로직 명확화.

### 3.2 메뉴 상태 전환 불일치
- **문제:** 일부 메뉴에서 상태 전환 후 안내문이 누락되거나 잘못 출력됨.
- **해결:** 각 상태 전환 시 printMenu(), printSensorIdMenu() 등 안내문 출력 함수 호출을 일관되게 적용.

## 4. 기타 문제 및 해결

### 4.1 pytest stdin 에러
- **문제:** pytest 실행 시 stdin 관련 에러 발생.
- **해결:** pyTestStart.py를 통해 환경변수로 시나리오 파일명을 전달하고, pytest CLI 인자 대신 환경변수 기반으로 테스트 실행.

### 4.2 인코딩/개행 차이
- **문제:** Windows 환경에서 
\n, 인코딩 차이로 테스트 실패.
- **해결:** test_json_driven_copy.py에서 출력 비교 시 .replace('\r','').replace('\n','')로 개행 차이 무시.

## 5. 향후 유지보수/테스트 팁
- 모든 시나리오 expect는 배열로 작성(멀티라인 안내문 대응)
- 펌웨어 안내문 변경 시, 시나리오 JSON과 테스트 코드도 함께 업데이트
- 테스트 실패 시, 로그에서 기대값/실제값을 비교하여 안내문/상태 전환 로직을 우선 점검
- 메뉴 안내문/상태 전환은 항상 printMenu(), printSensorIdMenu() 등 함수로 일관되게 출력
- Windows 환경에서는 인코딩/개행 차이로 인한 테스트 실패에 유의

---
이 문서는 실시간 테스트 및 펌웨어/테스트 코드 유지보수 시 반복적으로 참고할 수 있는 문제 해결 내역 및 패치 가이드입니다.
