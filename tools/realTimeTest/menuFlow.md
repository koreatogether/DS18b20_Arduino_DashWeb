# 펌웨어 메뉴 구조 및 상태별 출력 정리

## 1. 메뉴 계층 구조

```
[초기 상태 - appState: 0]
    ↓ "menu" 또는 "m" 입력
[메인 센서 제어 메뉴 - appState: 1]
===== 센서 제어 메뉴 =====
1. 센서 ID 조정
2. 상/하한 온도 조정
3. 취소 / 상태창으로 돌아가기
    ↓ "1" 입력
[센서 ID 조정 메뉴 - appState: 2]
--- 센서 ID 조정 메뉴 ---
1. 개별 센서 ID 변경
2. 복수의 센서 ID 변경
3. 주소순 자동 ID 할당
4. 전체 ID 초기화
5. 이전 메뉴 이동
6. 상태창으로 돌아가기
```

## 2. 상태별 "menu" 입력 시 출력

### 2.1 정상적인 경우 (appState: 0)
```
입력: "menu"
출력: "===== 센서 제어 메뉴 ====="
```

### 2.2 이미 메뉴 상태인 경우 (appState: 2)
```
입력: "menu" 
출력: 
[DEBUG] appState: 2
[DEBUG] inputBuffer: menu
지원하지 않는 메뉴입니다. 1, 5: 이전, 6: 상태창으로 돌아가기
--- 센서 ID 조정 메뉴 ---
```

## 3. 시나리오별 대응 방안

### 3.1 시나리오 03 (개별 센서 ID 변경)
- 첫 "menu" 입력 시 정상적으로 "===== 센서 제어 메뉴 ====" 출력
- 이유: 테스트 시작 시 appState가 0으로 초기화됨

### 3.2 시나리오 04 (복수 센서 ID 변경)
- 첫 "menu" 입력 시 "--- 센서 ID 조정 메뉴 ---" 출력
- 이유: 이전 테스트나 상태로 인해 appState가 2로 설정됨

## 4. 해결 방안

### 4.1 Robust한 시나리오 작성
```json
{
    "send": "menu\n",
    "expect": [
        "===== 센서 제어 메뉴 =====",
        "--- 센서 ID 조정 메뉴 ---"
    ]
}
```
- 두 경우 모두 대응 가능

### 4.2 상태 초기화 단계 추가
```json
{
    "send": "6\n",
    "expect": ["상태창"]
},
{
    "send": "menu\n", 
    "expect": ["===== 센서 제어 메뉴 ====="]
}
```
- 먼저 상태창으로 돌아가서 appState를 0으로 초기화

### 4.3 특정 상태에 맞는 시나리오
```json
// appState: 2인 경우를 가정한 시나리오
{
    "send": "menu\n",
    "expect": ["--- 센서 ID 조정 메뉴 ---"]
}
```

## 5. 권장 사항

### 5.1 테스트 시작 전 초기화
```json
{
    "description": "상태 초기화",
    "steps": [
        {
            "send": "6\n",
            "expect": ["상태창"]
        }
    ]
}
```

### 5.2 Robust한 expect 배열 사용
- 가능한 모든 출력 케이스를 배열에 포함
- 하나만 매칭되어도 통과하도록 설정

### 5.3 디버그 정보 활용
- `[DEBUG] appState: X` 정보를 expect에 포함하여 현재 상태 확인
- 예상과 다른 상태일 경우 적절한 대응

## 6. 04 시나리오 수정 예시

```json
{
    "steps": [
        {
            "send": "6\n",
            "expect": ["상태창", "센서 상태"]
        },
        {
            "send": "menu\n",
            "expect": ["===== 센서 제어 메뉴 ====="]
        },
        {
            "send": "1\n",
            "expect": ["--- 센서 ID 조정 메뉴 ---"]
        }
    ]
}
```

이렇게 하면 상태에 관계없이 일관성 있는 테스트가 가능합니다.
